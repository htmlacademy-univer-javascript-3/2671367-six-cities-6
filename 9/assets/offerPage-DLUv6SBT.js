import{j as e,r as n,R as _,b as l,u as h,d as u,e as f,g as v,h as x}from"./index-BySIDRPD.js";import{a as w,b as p,C as j}from"./cityMap-DtHETFxC.js";import{a as g,H as N,b,O as y}from"./headerContainer-AbjNHXZq.js";const R=s=>r=>s?r.review.reviewsByOfferId[s]??[]:[],C=({review:s})=>e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${s.rating*20}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:s.date,children:(()=>{try{return new Date(s.date).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric"})}catch{return"Invalid date"}})()})," "]})]}),O=[5,4,3,2,1],S=s=>{switch(s){case 5:return l.Perfect;case 4:return l.Good;case 3:return l.NotBad;case 2:return l.Badly;default:return l.Terribly}},k=()=>{const[s,r]=n.useState(null),[t,i]=n.useState(""),c=n.useCallback(a=>r(Number(a.target.value)),[]),m=n.useCallback(a=>i(a.target.value),[]),o=n.useCallback(a=>{a.preventDefault(),r(null),i("")},[]),d=s!==null&&t.length>=50;return e.jsxs("form",{className:"reviews__form form",onSubmit:o,children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:O.map(a=>e.jsxs(_.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:a,id:`rating-${a}`,type:"radio",checked:s===a,onChange:c}),e.jsx("label",{htmlFor:`rating-${a}`,className:"reviews__rating-label form__rating-label",title:S(a),children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},a))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"review",placeholder:"Tell how was your stay, what you like and what can be improved",value:t,onChange:m}),e.jsxs("div",{className:"reviews__button-wrapper",children:[e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!d,children:"Submit"})]})]})},T=({reviews:s})=>e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews Â· ",e.jsx("span",{className:"reviews__amount",children:s.length})]}),e.jsx("ul",{className:"reviews__list",children:s.map(r=>e.jsx(C,{review:r},r.id))}),e.jsx(k,{})]}),B=s=>h(R(s)),I=()=>{const s=w(),r=p(),{id:t}=u(),i=g(),c=B(t);return n.useEffect(()=>{t&&(i(f(t)),i(v(t)))},[t,i]),n.useEffect(()=>{s&&i(x({id:s.id,city:s.city.name}))},[i,s]),s?e.jsxs("div",{className:"page",children:[e.jsx(N,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsx(b,{offer:s,reviews:e.jsx(T,{reviews:c})}),e.jsx("section",{className:"offer__map map",children:e.jsx(j,{city:s.city,offers:[s,...r.slice(0,5)]})}),e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(y,{offers:r.slice(0,5),variant:"near-places"})]})})]})]}):null};export{I as default};
